<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="fragments/headTag :: headTag">...
</head>
<body>
	<script
		src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script type="text/javascript">
function savePass(){
    var pass = document.getElementById("pass").value;
    var valid = pass == document.getElementById("passConfirm").value;
	var token1 = $('input#csrf-token').attr("content"); 			
    if(!valid) {
      $("#error").show();
      return;
    }

	$.ajax({
		url: "/user/savePassword",
	    datatype : "html",
	    contentType: "application/x-www-form-urlencoded; charset=UTF-8", // this is the default value, so it's optional
		data: {
			password: pass
		},
		type: "POST",
        beforeSend: function (request)
        {
            request.setRequestHeader("X-CSRF-TOKEN", token1);
        },
		success: function(data) {
				window.location.href = "/login.html" + "?message=" + data.message;
		},
		fail: function(data) {
	        	window.location.href = "/login.html" + "?message=" + data.responseJSON.message;
		}
	});
}
</script>
	<div id="main">
		<div id="header" th:include="fragments/bodyHeader :: bodyHeader">
			...</div>
		<h2 th:text="#{message.resetYourPassword}">Update Password</h2>
		<!-- content begin -->
		<span class="error" th:if="${error}">There was a problem
			updating this customer</span> <span class="error"
			th:if="${passwordNoMatchError}">Passwords do not match</span>
		<input type="hidden" id= "csrf-token" th:name="${_csrf.parameterName}" th:content="${_csrf.token}" />

		<table class="formTable">
			<tr th:if="${#vars['validationErrorFlag'] != null}">
				<td colspan="2" style="text-align: left" class="error smallText">
					<span th:if="${nameError} != null"
					th:text="#{validationErrorMessage}"> <br /> <span
						class="indent" th:text="#{nameError}"></span>
				</span> <span th:if="${passwordError} != null"
					th:text="#{validationErrorMessage}">\ <br /> <span
						class="indent">password</span>
				</span>
				</td>
			</tr>

			<tr>
				<td><label for="newPassword"
					th:text="|#{label.user.newPassword}:|">password</label></td>
				<td class="inputField"><input type="password"
					id="pass" value="" /></td>
			</tr>
			<tr>
				<td><label for="confirmPass"
					th:text="|#{label.user.confirmPass}:|">confirm password:</label></td>
				<td class="inputField"><input type="password"
					id="passConfirm" value="" /></td>
			</tr>
			<tr>
				<td colspan="2"><button type="submit" value="submit"
					onclick="savePass()" th:text="#{message.updatePassword}"></button></td>
			</tr>
		</table>

		<!-- content end -->

		<div id="footer" th:include="fragments/bodyFooter :: bodyFooter"></div>
	</div>
	<span class="error" th:if="${success}"> <script
			type="text/javascript">
		loginRedirect();
	</script>
	</span>
</body>
</html>